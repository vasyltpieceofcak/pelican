jQuery(function(p){"use strict";var d={STORAGE_KEY:"expert_review_likes:"+function(e){var t,i,n,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,r="";for(;t=e.charCodeAt(o++),i=e.charCodeAt(o++),n=e.charCodeAt(o++),t=(s=t<<16|i<<8|n)>>12&63,i=s>>6&63,n=63&s,r+=a.charAt(s>>18&63)+a.charAt(t)+a.charAt(i)+a.charAt(n),o<e.length;);switch(e.length%3){case 1:r=r.slice(0,-2)+"==";break;case 2:r=r.slice(0,-1)+"="}return r}(window.location.origin),_items:[],init:function(){var e;return"undefined"!=typeof localStorage&&(e=localStorage.getItem(this.STORAGE_KEY))&&(e=JSON.parse(e),this._items=e.items),this},store:function(){var e;return"undefined"!=typeof localStorage&&(e={items:this._items},localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))),this},like:function(e,t){return this._act(e,"like",t),this},dislike:function(e,t){return this._act(e,"dislike",t),this},remove:function(e,t){return this._act(e,"remove",t),this},_act:function(t,e,i){i=i||"posts";var n=this._items.filter(function(e){return e.hasOwnProperty("e")&&e.e!==i||e.id!==t});"remove"!==e&&n.push({id:t,a:e,e:i}),this._items=n},isLiked:function(e,t){return this._check(e,"like",t)},isDisliked:function(e,t){return this._check(e,"dislike",t)},_check:function(t,e,i){i=i||"posts";var n=this._items.filter(function(e){return e.hasOwnProperty("e")?e.e===i&&e.id===t:"posts"===i&&e.id===t});return!!n.length&&n[0].a===e}};d.init();function e(){p(".js-expert-review-likes-button").each(function(){var e,t,i,n,s=p(this);s.data("init")||(s.data("init",!0),e=s.parents(".js-expert-review-likes-button-container"),t=s.parent().data(),n=null,"posts"===(i=(i=e.data("entity_type"))||"posts")?t.hasOwnProperty("name")?n=t.name:t.hasOwnProperty("post_id")&&(n=t.post_id):"comments"===i&&(n=e.data("comment_id")),n&&("like"===s.data("type")||"toggle"===s.data("type")?s.addClass(d.isLiked(n,i)?"voted":""):"dislike"===s.data("type")&&s.addClass(d.isDisliked(n,i)?"voted":"")))})}function c(e){return 1e6<e?(e/1e6).toFixed(1)+"&nbsp;m.":1e5<e?(e/1e3).toFixed(0)+"&nbsp;k.":1e3<e?(e/1e3).toFixed(1)+"&nbsp;k.":e}(document.wpshopExpertReview_InitLikes=e)(),p(document).on("journalx_load_post",function(){setTimeout(e,100)}),p(document).on("click",".js-expert-review-likes-button",function(e){e.preventDefault();var t=p(this),i=t.parents(".js-expert-review-likes-button-container"),s=(s=i.data("entity_type"))||"posts",a=null,o=t.data("type"),r="toggle"===o?"like":o,e=t.parent().data(),l=!1;if((!t.hasClass("voted")||"toggle"===o)&&("posts"===s?e.hasOwnProperty("name")?(a=e.name,l=!0):e.hasOwnProperty("post_id")&&(a=e.post_id):"comments"===s&&(a=i.data("comment_id")),a)){i=!0;if("toggle"===o)d.isLiked(a,s)?i=!(r="dislike"):d.isDisliked(a,s)&&(i=!(r="like"));else if("like"===o){if(d.isLiked(a,s))return;i=!d.isDisliked(a,s)}else if("dislike"===o){if(d.isDisliked(a,s))return;i=!d.isLiked(a,s)}i={action:"expert_review_save_like",nonce:expert_review_ajax.nonce,is_named:l?1:0,entity:s,id:a,type:o,click_type:r,is_new:i?1:0};p.ajax({url:expert_review_ajax.url,type:"post",data:i,beforeSend:function(){t.addClass("loading"),t.prop("disabled",!0)}}).done(function(n){var e;n.success?(e="comments"===s?'.js-expert-review-likes-button-container[data-comment_id="'+a+'"]':l?'.js-expert-review-likes-button-container[data-name="'+a+'"]':'.js-expert-review-likes-button-container[data-post_id="'+a+'"]',p(document).find(e).each(function(){var e=p(this),t=e.find(".js-expert-review-likes-count"),i=e.find(".js-expert-review-dislikes-count");t.html(c(n.data.likes)),i.html(c(n.data.dislikes)),e.find(".js-expert-review-likes-button").removeClass("voted"),"dislike"!==r?e.find('.js-expert-review-likes-button[data-type!="dislike"]').addClass("voted"):"toggle"!==o&&e.find('.js-expert-review-likes-button[data-type="dislike"]').addClass("voted")}),"like"===o?d.like(a,s):"dislike"===o?d.dislike(a,s):"like"===r?d.like(a,s):d.remove(a,s),d.store(),l&&(p(document).find('.js-expert-review-like-rate[data-name="'+a+'"]').text(n.data.rate),p(document).find('.js-expert-review-like-activity[data-name="'+a+'"]').text(n.data.activity))):console.log(n)}).always(function(){t.removeClass("loading"),t.prop("disabled",!1)})}})}),jQuery(function(r){"use strict";function e(){r(".js-expert-review-poll").each(function(){var e,t,i=r(this);i.data("init")||(i.data("init",!0),t=i.data("id"),(e=parseInt(i.data("r")))&&l.reset(t,e),(e=l.getAnswer(t))&&(i.addClass("voted"),i.find('.js-expert-review-poll-item[data-id="'+e.a+'"]').addClass("voted"),i.find(".js-expert-review-poll-result-button").hide()),void 0===(t=i.data("can_vote"))||t?e||i.find(".js-expert-review-poll-result-button").show():i.addClass("voted"))})}var l=new function(){var e="expert_review_polls_v1:"+function(e){var t,i,n,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,r="";for(;t=e.charCodeAt(o++),i=e.charCodeAt(o++),n=e.charCodeAt(o++),t=(s=t<<16|i<<8|n)>>12&63,i=s>>6&63,n=63&s,r+=a.charAt(s>>18&63)+a.charAt(t)+a.charAt(i)+a.charAt(n),o<e.length;);switch(e.length%3){case 1:r=r.slice(0,-2)+"==";break;case 2:r=r.slice(0,-1)+"="}return r}(window.location.origin),i={votes:{},reset:0};{var t;"undefined"==typeof localStorage||(t=localStorage.getItem(e))&&(i=JSON.parse(t))}return{vote:function(e,t){i.votes[e]={a:t,t:Date.now()/1e3|0},n()},getAnswer:function(e){return i.votes.hasOwnProperty(e)?i.votes[e]:null},reset(e,t){void 0!==i.votes[e]&&(i.votes[e].t<t&&delete i.votes[e],n())},resetAll:function(e){if(e&&(!i.reset||i.reset<e)){for(var t in i.reset=e,i.votes)i.votes[t].t<e&&delete i.votes[t];n()}}};function n(){"undefined"!=typeof localStorage&&localStorage.setItem(e,JSON.stringify(i))}};(document.wpshopExpertReview_InitPoll=e)(),r(document).on("journalx_load_post",function(){setTimeout(e,100)}),r("body").on("journalx_load_post",e),r(document).on("click",".js-expert-review-poll-item",function(e){e.preventDefault();var t=r(this),i=t.parents(".js-expert-review-poll"),n=r('<div class="expert-review-poll__loader"><span></span></div>').clone(),e=t.data("can_vote");if(void 0===e||e){if(i.hasClass("voted"))return!1;var s=i.data("id"),a=t.data("id"),e={action:"expert_review_save_poll_vote",nonce:expert_review_ajax.nonce,question:s,answer:a};r.ajax({url:expert_review_ajax.url,type:"post",data:e,beforeSend:function(){i.append(n),t.prop("disabled",!0)}}).done(function(e){var o;e.success?(r('.js-expert-review-poll[data-id="'+s+'"]').each(function(){var e=r(this);e.addClass("voted"),e.find('.js-expert-review-poll-item[data-id="'+a+'"]').addClass("voted")}),l.vote(s,a),r(document.body).trigger("expert_review_poll_voted",[t,i]),i.find(".js-expert-review-poll-result-button").hide(),o=e.data,r('.js-expert-review-poll[data-id="'+s+'"]').each(function(){var e,t=r(this),i=o.total;for(e in o.votes){var n,s=t.find('.js-expert-review-poll-item[data-id="'+e+'"]');s.length&&(n=Math.round(o.votes[e]/(i||o.votes[e])*100),s.find(".js-expert-review-poll-item-num").text(n+"%"),s.find(".js-expert-review-poll-item-progress").css("width",n+"%"))}var a=t.find(".js-expert-review-poll-count");a.length&&a.text(i)})):console.log(e)}).always(function(){n.remove(),t.prop("disabled",!1)})}}),r(document).on("click",".js-expert-review-poll-result-button",function(e){e.preventDefault();var t=r(e.currentTarget),e=t.data("toggle_txt");t.blur(),t.data("toggle_txt",t.text()),t.text(e),t.hasClass("used")?(t.parents(".js-expert-review-poll").removeClass("voted"),t.removeClass("used")):(t.parents(".js-expert-review-poll").addClass("voted"),t.addClass("used"))})}),jQuery(function(l){var p,d=expert_review_ajax||{},c=d.i18n,u=l('<div class="expert-review-popup__loader"><span></span></div>');l(document).on("click",".js-expert-review-button",function(e){e.preventDefault();var t,i,n,s=l(this).data("settings");switch(s.type){case"popup":t=s,"function"!=typeof expert_review_question_popup?(i=t.use_phone?"        <label>"+c.question_popup_phone+': <input type="text" name="_p" class="required"></label>':"        <label>"+c.question_popup_email+': <input type="text" name="_a" class="required"></label>',n=parseInt(d.consent)?'        <label><input type="checkbox" name="consent" value="1" class="required"> '+c.consent+"</label>":"",n='<div class="expert-review-popup-holder js-expert-review-popup"><div class="expert-review-popup">    <span class="expert-review-popup__close js-expert-review-close-mark">&times;</span>    <div class="expert-review-popup__content">        <form>        <label>'+c.question_popup_name+': <input type="text" name="name" class="required"></label>'+i+'        <input type="hidden" name="email">        <label>'+c.question_popup_question+': <textarea name="text" class="required"></textarea></label>'+n+'        <button type="submit" class="expert-review-popup__submit">'+c.question_popup_submit+'</button>        <span class="expert-review-popup__cancel js-expert-review-cancel">'+c.question_popup_cancel+"</span>"+l('<input type="hidden" name="settings">').val(JSON.stringify(t)).prop("outerHTML")+"        </form>    </div></div></div>",l("body").append(n)):l("body").append(expert_review_question_popup(c,t));break;case"comments":"function"!=typeof expert_review_scroll_to_comments?(t="#comments",d.comment_to_scroll_selector&&(t=d.comment_to_scroll_selector),(t=l(t)).length&&l("html, body").animate({scrollTop:t.offset().top},200)):expert_review_scroll_to_comments();break;case"link":void 0!==s.link&&s.link.length&&(0===s.link.indexOf("#")?window.location.hash=s.link:e.ctrlKey||parseInt(d.ask_question_link_new_tab)?l('<a href="'+s.link+'" target="_blank" rel="noopener"></a>')[0].click():document.location=s.link);break;case"custom":"function"==typeof window.expert_review_custom_ask_question_fn&&expert_review_custom_ask_question_fn(s)}}),l(document).on("click",'.js-expert-review-popup button[type="submit"]',function(e){e.preventDefault();function i(e){o.find("form").prepend('<p class="fail-message">'+e+"</p>"),clearTimeout(t),t=setTimeout(function(){o.find(".fail-message").remove()},5e3)}var t,n,s,a=l(this),o=a.parents(".js-expert-review-popup"),e=o.find("form"),r=u.clone();!function(e){e.find(".js-expert-review-validation-message").remove();var t=!0;e.find("input.required, textarea.required").each(function(){var e=l(this);e.is(":checkbox")?e.is(":checked")||(t=!1,e.parents("label").append('<p class="js-expert-review-validation-message validation-failed">'+c.field_must_be_checked+"</p>")):e.val().trim()||(t=!1,e.parents("label").append('<p class="js-expert-review-validation-message validation-failed">'+c.field_cannot_be_empty+"</p>"))}),clearTimeout(p),t||(p=setTimeout(function(){e.find(".js-expert-review-validation-message").hide(150,function(){l(this).remove()})},5e3));return t}(e)||(e=(e=o.find("form")).serializeArray(),s={},l.map(e,function(e,t){s[e.name]=e.value}),l.ajax({url:d.url,type:"post",data:{action:"expert_review_submit_question",nonce:d.nonce,data:n=s},beforeSend:function(){a.prop("disabled",!0),o.find(".expert-review-popup").append(r)}}).done(function(e){e.success?(o.find("form").prepend('<p class="success-message">'+c.question_submitted+"</p>"),setTimeout(function(){o.remove()},3e3),document.dispatchEvent(new CustomEvent("expert_review_question:submit",{detail:{request:n,response:e}}))):e.data&&Array.isArray(e.data)?e.data.reverse().forEach(function(e){var t=e.message;"legacy_form"===e.code&&(console.error(t),t=c.legacy_form),i(t)}):e.data&&e.data.message&&i(e.data.message)}).always(function(){a.prop("disabled",!1),r.remove()}))}),l(document).on("click",".js-expert-review-cancel, .js-expert-review-close-mark",function(e){e.preventDefault(),l(this).parents(".js-expert-review-popup").remove()}),l(document).keyup(function(e){27===e.keyCode&&l(".js-expert-review-close-mark").trigger("click")}),l("body").on("click",function(e){e=l(e.target);e.is(".js-expert-review-popup")&&!e.find().is(".js-expert-review-popup")&&l(".js-expert-review-close-mark").trigger("click")}),l(document).on("click",".js-expert-review-faq-item-question",function(e){e.preventDefault();e=l(this).parent();e.hasClass("expand")?e.removeClass("expand"):e.addClass("expand");l(this).parent().find(".js-expert-review-faq-item-answer").slideToggle()})});